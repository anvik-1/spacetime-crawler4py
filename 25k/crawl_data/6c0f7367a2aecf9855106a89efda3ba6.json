{"url": "https://grape.ics.uci.edu/wiki/public/wiki/cs122b-2016-spring-project5-mysql-master-slave?action=diff&version=1", "word_count": 933, "words": ["cs122b-2016-spring-project5-mysql-master-slave", "(diff)", "\u2013", "Public", "Login", "Preferences", "About", "Trac", "Register", "Context", "Navigation", "\u2190", "Previous", "Change", "Wiki", "History", "Next", "Change", "\u2192", "Changes", "between", "Initial", "Version", "and", "Version", "1", "of", "cs122b-2016-spring-project5-mysql-master-slave", "View", "differences", "inline", "side", "by", "side", "Show", "lines", "around", "each", "change", "Show", "the", "changes", "in", "full", "context", "Ignore:", "Blank", "lines", "Case", "changes", "White", "space", "changes", "Timestamp:", "May", "17,", "2016,", "4:22:31", "PM", "(", "9", "years", "ago)", "Author:", "mahdi", "Comment:", "--", "Legend:", "Unmodified", "Added", "Removed", "Modified", "cs122b-2016-spring-project5-mysql-master-slave", "v1", "v1", "1", "2", "===", "MySQL", "Master-Slave", "Replication", "===", "3", "4", "This", "tutorial", "shows", "how", "to", "setup", "a", "MySQL", "cluster", "on", "AWS", "that", "includes", "a", "master", "and", "a", "slave.", "Reads", "can", "be", "sent", "to", "any", "of", "the", "two", "instances,", "and", "writes", "have", "to", "be", "sent", "to", "the", "master", "instance.", "5", "6", "1.", "Setup", "two", "new", "AWS", "instances:", "7", "i.", "Create", "two", "new", "AWS", "instances", "identical", "to", "your", "previous", "instance", "used", "to", "run", "Fabflix.", "We", "call", "these", "\"instance", "2\"", "(as", "the", "master)", "and", "\"instance", "3\"'", "(as", "the", "slave).", "We", "assume", "their", "public", "IPs", "are", "2.2.2.2", "and", "3.3.3.3,", "and", "their", "internal", "AWS", "IPs", "are", "172.2.2.2", "and", "172.3.3.3,", "respectively.", "8", "i.", "Add", "new", "rules", "in", "their", "security", "group(s)", "to", "open", "their", "`MYSQL/Aurora`", "type", "to", "each", "other", "using", "their", "AWS", "internal", "IP.", "9", "1.", "Watch", "[https://www.youtube.com/watch?v=JXDuVypcHNA", "this", "video]", "to", "have", "a", "good", "understanding", "of", "this", "feature.", "The", "following", "steps", "are", "mainly", "based", "on", "those", "instructions", "in", "the", "video.", "10", "1.", "Set", "up", "the", "master", "instance.", "11", "i.", "SSH", "to", "the", "master", "instance.", "Run", "the", "following", "command", "to", "install", "MySQL", "server.", "12", "{{{", "13", "master-shell>", "sudo", "apt-get", "update", "14", "master-shell>", "sudo", "apt-get", "install", "mysql-server", "15", "}}}", "16", "i.", "Edit", "the", "`/etc/mysql/my.cnf`", "file", "and", "set", "the", "`bind-address`", "to", "'''0.0.0.0'''.", "Also,", "uncomment", "the", "lines", "of", "`server-id`", "and", "`log_bin`", "properties.", "17", "i.", "Restart", "the", "MySQL", "service.", "18", "{{{", "19", "master-shell>", "sudo", "service", "mysql", "restart", "20", "}}}", "21", "i.", "Login", "to", "the", "MySQL", "console.", "Create", "a", "new", "user", "and", "give", "it", "the", "permission", "for", "replicating", "the", "database:[[BR]]", "22", "{{{", "23", "master-shell>", "mysql", "-u", "root", "-p", "24", "master-mysql>", "create", "user", "'repl'@'%'", "identified", "by", "'slavepassword';", "25", "master-mysql>", "grant", "replication", "slave", "on", "*.*", "to", "'repl'@'%'", ";", "26", "}}}", "27", "i.", "Run", "the", "following", "command", "in", "MySQL", "console", "to", "get", "the", "status", "about", "the", "master", "MySQL:[[BR]]", "28", "{{{", "29", "master-mysql>", "show", "master", "status;", "30", "}}}", "31", "Keep", "the", "values", "of", "the", "`File`", "and", "`Position`", "columns,", "as", "they", "are", "needed", "in", "the", "next", "step.", "For", "example,", "these", "values", "are", "`mysql-bin.000001`", "and", "`337`.", "32", "1.", "Set", "up", "the", "slave", "instance:", "33", "i.", "SSH", "to", "the", "slave", "instance.", "Run", "the", "following", "commands", "to", "install", "MySQL", "server.", "34", "{{{", "35", "slave-shell>", "sudo", "apt-get", "update", "36", "slave-shell>", "sudo", "apt-get", "install", "mysql-server", "37", "}}}", "38", "i.", "Edit", "the", "`/etc/mysql/my.cnf`", "file", "and", "set", "the", "`bind-address`", "to", "'''0.0.0.0'''.", "Also,", "uncomment", "the", "`server-id`", "property", "and", "use", "value", "2.", "Do", "'''not'''", "uncomment", "the", "`log_bin`", "property.", "39", "i.", "Restart", "the", "MySQL", "service.", "40", "{{{", "41", "slave-shell>", "sudo", "service", "mysql", "restart", "42", "}}}", "43", "i.", "Login", "to", "the", "MySQL", "console", "and", "let", "the", "slave", "know", "about", "the", "master", "server:[[BR]]", "44", "{{{", "45", "slave-shell>", "mysql", "-u", "root", "-p", "46", "slave-mysql>", "CHANGE", "MASTER", "TO", "MASTER_HOST='172.2.2.2',", "MASTER_USER='repl',", "MASTER_PASSWORD='slavepassword',", "MASTER_LOG_FILE='mysql-bin.000001',", "MASTER_LOG_POS=337;", "47", "}}}", "48", "Note", "that", "the", "values", "used", "for", "`MASTER_LOG_FILE`", "and", "`MASTER_LOG_POS`", "are", "the", "ones", "from", "the", "last", "step.", "49", "i.", "Start", "the", "MySQL", "slave:[[BR]]", "50", "{{{", "51", "slave-mysql>", "start", "slave;", "52", "slave-mysql>", "show", "slave", "status\\G;", "53", "}}}", "54", "It", "should", "show", "\"Slave_IO_State:", "Waiting", "for", "master", "to", "send", "event\".", "55", "1.", "Test", "if", "the", "synchronization", "works:", "56", "i.", "On", "the", "master", "instance,", "create", "a", "database", "with", "a", "table", "with", "a", "tuple:", "57", "{{{", "58", "master-shell>", "mysql", "-u", "root", "-p", "59", "master-mysql>", "create", "database", "pets;", "60", "master-mysql>", "use", "pets;", "61", "master-mysql>", "create", "table", "pets(name", "varchar(20));", "62", "master-mysql>", "insert", "into", "pets", "values", "(\"fluffy\");", "63", "}}}", "64", "i.", "On", "the", "slave", "instance,", "check", "if", "the", "data", "has", "been", "propagated", "from", "the", "master:", "65", "{{{", "66", "slave-shell>", "mysql", "-u", "root", "-p", "67", "slave-mysql>", "show", "databases;", "68", "slave-mysql>", "use", "pets;", "69", "slave-mysql>", "show", "tables;", "70", "slave-mysql>", "select", "*", "from", "pets;", "71", "}}}", "72", "We", "should", "be", "able", "to", "see", "the", "database,", "table,", "and", "record", "on", "this", "instance", "propagated", "from", "the", "master.", "If", "so,", "congratulations!", "73", "1.", "Move", "data", "from", "the", "original", "instance", "used", "in", "project", "2", "(let's", "call", "it", "\"Instance", "1\"", ")", "to", "the", "master", "instance:", "74", "i.", "On", "instance", "1,", "dump", "the", "data", "of", "the", "\"moviedb\"", "database", "to", "a", "file:", "75", "{{{", "76", "instance1-shell>", "mysqldump", "-u", "root", "-p", "--databases", "moviedb", ">", "~/movie-dump.sql", "77", "}}}", "78", "i.", "In", "the", "security", "group", "of", "the", "master", "instance,", "allow", "SSH", "access", "from", "the", "frontend", "instance", "to", "the", "master", "instance.", "79", "i.", "On", "instance", "1,", "copy", "the", "MySQL", "dump", "file", "to", "the", "master", "instance", "(you", "need", "to", "have", "the", "pem", "key", "available", "on", "instance", "1:", "80", "{{{", "81", "instance1-shell>", "scp", "-i", "\"mykey.pem\"", "~/movie-dump.sql", "ubuntu@[Master_Instance_private_IP]:~/", "82", "}}}", "83", "i.", "On", "the", "master", "instance,", "create", "a", "database", "\"moviedb\".", "Then", "load", "the", "data", "from", "the", "dump", "file", "into", "its", "own", "MySQL,", "and", "check", "its", "status.", "84", "{{{", "85", "master-shell>", "mysql", "-u", "root", "-p", "moviedb", "<", "~/movie-dump.sql", "86", "master-shell>", "mysql", "-u", "root", "-p", "87", "master-mysql>", "use", "moviedb;", "show", "tables;", "88", "}}}", "89", "i.", "On", "the", "slave", "instance,", "check", "if", "the", "data", "is", "automatically", "propagated:", "90", "{{{", "91", "slave-shell>", "mysql", "-u", "root", "-p", "92", "slave-mysql>", "use", "moviedb;", "show", "tables;", "93", "}}}", "94", "95", "Note:", "The", "propagation", "is", "only", "from", "the", "master", "to", "the", "slave,", "not", "the", "other", "way", "around.", "To", "test", "it,", "you", "can", "insert", "some", "records", "to", "a", "table", "in", "the", "slave", "database,", "and", "check", "if", "it's", "propagated", "to", "the", "master", "instance.", "It", "should", "NOT!", "Powered", "by", "Trac", "1.5.3", "By", "Edgewall", "Software", ".", "Visit", "the", "Trac", "open", "source", "project", "at", "http://trac.edgewall.org/"], "content_hash": "eda49e93e0f070cf7fcd35d538e94cfb"}