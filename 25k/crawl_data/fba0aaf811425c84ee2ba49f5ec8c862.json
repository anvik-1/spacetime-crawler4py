{"url": "https://grape.ics.uci.edu/wiki/public/wiki/cs122b-2017-winter-project5?version=12", "word_count": 2386, "words": ["cs122b-2017-winter-project5", "\u2013", "Public", "Login", "Preferences", "About", "Trac", "Register", "wiki:", "cs122b-2017-winter-project5", "Context", "Navigation", "\u2190", "Previous", "Version", "View", "Latest", "Version", "Next", "Version", "\u2192", "Version", "12", "(modified", "by", "chenli", ",", "9", "years", "ago", ")", "(", "diff", ")", "--", "CS122B", "Project", "5:", "Scaling", "Fabflix", "and", "Performance", "Tuning", "Task", "1:", "Connection", "Pooling", "and", "Prepared", "Statements", "Task", "2:", "Scaling", "Fabflix", "Task", "3:", "Measuring", "the", "performance", "of", "Fabflix", "search", "feature", "Task", "3.1:", "Preparing", "the", "codebase", "for", "time", "measurement", "Task", "3.2:", "Preparing", "the", "test", "plan", "in", "Apache", "JMeter", "Task", "3.3:", "Collecting", "the", "performance", "results", "Preparing", "the", "Package", "for", "Submission", "CS122B", "Project", "5:", "Scaling", "Fabflix", "and", "Performance", "Tuning", "Due:", "March", "17,", "2017,", "Friday,", "11:45", "pm.", "Submit", "on", "EEE.", "Notice", "that", "we", "use", "1", "day", "after", "the", "official", "deadline", "as", "the", "submission", "cut-off", "time", "on", "EEE", "to", "allow", "you", "to", "use", "the", "24-hour", "grace", "period", "if", "you", "chose", "so.", "After", "that,", "EEE", "will", "no", "longer", "accept", "submissions.", "This", "project", "has", "the", "following", "tasks:", "JDBC", "connection", "pooling", "and", "Prepared", "statements", "Scaling", "Fabflix", "with", "a", "cluster", "of", "MySQL/Tomcat", "and", "a", "frontend", "load", "balancer;", "Measuring", "the", "performance", "of", "Fabflix", "search", "feature", "Task", "1:", "Connection", "Pooling", "and", "Prepared", "Statements", "In", "this", "task,", "we", "will", "enable", "Fabflix", "with", "Connection", "Pooling", "and", "Prepared", "Statements.", "Step", "1:", "Make", "the", "necessary", "changes", "and", "make", "sure", "to", "use", "Prepared", "Statements", "in", "all", "JDBC", "statements", "involved", "in", "search.", "You", "can", "use", "this", "\u200b", "tutorial", "on", "prepared", "statements.", "Step", "2:", "Enable", "JDBC", "connection", "pooling", "for", "Fabflix.", "We", "will", "use", "our", "running", "application", "of", "\"TomcatTest\"", "to", "show", "how", "to", "change", "it", "to", "use", "connection", "pooling.", "Note:", "We", "do", "not", "know", "whether", "the", "instructions", "will", "work", "for", "JSP", "or", "not.", "Download", "and", "deploy", "the", "following", "TomcatPooling.war", "\u200b", "file.", "The", "file", "TomcatPooling\\META-INF\\context.xml", "includes", "important", "information", "about", "the", "database,", "user", "name,", "password,", "and", "pooling", "configuration.", "If", "you", "want", "to", "change", "this", "file,", "you", "need", "to", "undeploy", "the", "war", "file,", "make", "those", "changes,", "make", "a", "new", "war", "file,", "and", "deploy", "the", "new", "war", "file.", "Otherwise,", "the", "Tomcat", "server", "may", "still", "use", "the", "previous", "context.xml.", "Check", "\u200b", "http://tomcat.apache.org/tomcat-8.5-doc/jndi-datasource-examples-howto.html", "for", "more", "information", "about", "how", "to", "configure", "connection", "pooling.", "Go", "to", "the", "link", "\u200b", "http://localhost:8080/TomcatPooling/servlet/TomcatTest", "to", "test", "your", "application.", "You", "must", "see", "a", "list", "of", "rows", "displayed", "on", "the", "webpage.", "Look", "into", "the", "following", "files", "for", "the", "main", "changes", "in", "this", "war", "file", "compared", "to", "the", "previous", "war", "file", "without", "connection", "pooling:", "\\META-INF\\context.xml", ".", "\\WEB-INF\\sources\\TomcatTest.java", "\\WEB-INF\\web.xml", "(see", "the", "resource-ref", "tag).", "You", "may", "also", "find", "some", "useful", "links", "for", "connection", "pooling", "from", "\u200b", "this", "tutorial", ".", "When", "you", "are", "done,", "write", "an", "explanation", "of", "how/where", "you", "use", "the", "JDBC", "connection", "pooling", "in", "your", "code.", "You", "should", "submit", "this", "report", "to", "EEE.", "Task", "2:", "Scaling", "Fabflix", "Step", "1", ":", "Setup", "two", "AWS", "instances", "as", "two", "backend", "servers", "by", "following", "this", "MySQL", "replication", "tutorial", ".", "We", "call", "them", "the", "\"master", "instance\"", "and", "the", "\"slave", "instance\"", "(in", "the", "context", "of", "MySQL", "replication).", "Step", "2", "(master/slave)", ":", "Create", "a", "dummy", "user", "for", "two", "example", "Tomcat", "applications:", "shell>", "mysql", "-u", "root", "-p", "mysql>", "CREATE", "USER", "'mytestuser'@'localhost'", "IDENTIFIED", "BY", "'mypassword';", "mysql>", "GRANT", "ALL", "ON", "*.*", "TO", "'mytestuser'@'localhost';", "Step", "3", "(master/slave)", ":", "Setup", "Tomcat", "on", "each", "master/slave", "instance.", "(You", "should", "have", "done", "it", "many", "times.)", "Step", "4", "(master/slave)", ":", "On", "each", "master/slave", "instance,", "deploy", "TomcatTest.war", ".", "Make", "the", "URL", "\u200b", "http://PUBLIC_IP:8080/TomcatTest/servlet/TomcatTest", "work.", "You", "may", "need", "to", "modify", "the", "username/password", "and", "IP", "address", "(use", "the", "internal", "AWS", "instance", "address).", "Also", "make", "sure", "to", "modify", "the", "AWS", "security", "group", "setting", "for", "these", "two", "instances", "to", "allow", "remote", "access", "to", "their", "8080", "port.", "Step", "5", "(master/slave)", ":", "On", "each", "master/slave", "instance,", "deploy", "Session.war", ".", "Make", "the", "URL", "\u200b", "http://PUBLIC_IP:8080/Session/servlet/ShowSession?myname=Michael", "work.", "Step", "6", "(instance", "1)", ":", "On", "the", "instance", "that", "runs", "the", "original", "Fablix", "instance", "(called", "\"instance", "1\"),", "setup", "Apache", "and", "its", "proxy", "by", "doing", "the", "following:", "Install", "Apache2", "and", "related", "modules:", "instance1-shell>", "sudo", "apt-get", "install", "apache2", "instance1-shell>", "sudo", "a2enmod", "proxy", "proxy_balancer", "proxy_http", "rewrite", "headers", "lbmethod_byrequests", "instance1-shell>", "service", "apache2", "restart", "Configure", "the", "Apache2", "web", "server", "to", "use", "its", "proxy_balancer", "module", "for", "sharing", "(i.e.,", "redirecting)", "requests", "to", "the", "backend", "instances.", "To", "do", "it,", "edit", "the", "following", "configuration", "file:", "instance1-shell>", "sudo", "vim", "/etc/apache2/sites-enabled/000-default.conf", "Create", "a", "load", "balancer", "proxy,", "whose", "members", "are", "the", "backend", "instances.", "In", "particular,", "define", "a", "proxy", "on", "top", "of", "the", "file,", "before", "the", "<VirtualHost", "*:80>", "tag.", "<Proxy", "\"balancer://TomcatTest_balancer\">", "BalancerMember", "\"http://172.2.2.2:8080/TomcatTest/\"", "BalancerMember", "\"http://172.3.3.3:8080/TomcatTest/\"", "</Proxy>", "Here", "we", "assume", "'172.2.2.2'", "and", "'172.3.3.3'", "are", "the", "private", "IP", "address", "of", "the", "master", "and", "slave", "instances,", "respectively.", "Add", "two", "new", "rules", "in", "the", "body", "of", "the", "VirtualHost", "tag.", "ProxyPass", "/TomcatTest", "balancer://TomcatTest_balancer", "ProxyPassReverse", "/TomcatTest", "balancer://TomcatTest_balancer", "Restart", "Apache:", "instance1-shell>", "sudo", "service", "apache2", "restart", "Modify", "the", "security", "group", "of", "the", "two", "backend", "instances", "to", "allow", "instance", "1", "to", "access", "their", "8080", "port.", "These", "settings", "will", "redirect", "HTTP", "requests", "to", "\"instance1_IP/TomcatTest\"", "to", "one", "of", "the", "two", "backend", "instances.", "To", "test", "it,", "use", "a", "browser", "to", "point", "to", "\u200b", "http://instance1_IP/TomcatTest/servlet/TomcatTest", ".", "Check", "the", "Tomcat", "log", "of", "the", "two", "backend", "instances.", "One", "of", "them", "should", "receive", "that", "request.", "Keep", "refreshing", "the", "page", "to", "send", "multiple", "requests,", "and", "check", "if", "the", "two", "backends", "are", "receiving", "the", "requests", "evenly.", "Step", "7", "(instance", "1)", ":", "Configure", "the", "proxy", "on", "instance", "1", "to", "handle", "sessions", "properly.", "Since", "the", "current", "setting", "will", "send", "requests", "randomly", "to", "the", "backend,", "it", "will", "not", "pass", "cookies", "properly,", "causing", "sessions", "to", "fail.", "We", "want", "to", "make", "the", "session", "persist", "over", "several", "requests", "of", "the", "same", "client,", "i.e.,", "to", "have", "a", "sticky", "session.", "To", "do", "it,", "read", "the", "\u200b", "instructions", ",", "especially", "those", "under", "\"Examples", "of", "a", "balancer", "configuration.\"", "Here's", "a", "sample", "setting", "for", "the", "/etc/apache2/sites-enabled/000-default.conf", "file", "for", "the", "\"Session.war\"", "application:", "Header", "add", "Set-Cookie", "\"ROUTEID=.%{BALANCER_WORKER_ROUTE}e;", "path=/\"", "env=BALANCER_ROUTE_CHANGED", "<Proxy", "\"balancer://Session_balancer\">", "BalancerMember", "\"http://172.2.2.2:8080/Session\"", "route=1", "BalancerMember", "\"http://173.3.3.3:8080/Session\"", "route=2", "ProxySet", "stickysession=ROUTEID", "</Proxy>", "Also", "do", "the", "following:", "Add", "two", "new", "rules", "in", "the", "body", "of", "the", "VirtualHost", "tag.", "ProxyPass", "/Session", "balancer://Session_balancer", "ProxyPassReverse", "/Session", "balancer://Session_balancer", "Restart", "Apache:", "instance1-shell>", "sudo", "service", "apache2", "restart", "Test", "if", "it", "works", "by", "pointing", "to", "the", "URL", "\u200b", "http://instance1_IP/Session/servlet/ShowSession?myname=Michael", "of", "instance", "1.", "It", "should", "access", "one", "of", "the", "backend", "instances", "only.", "Step", "8", "(instance", "1)", ":", "Send", "write", "operations", "to", "the", "master", "instance", "only.", "Since", "eventually", "we", "want", "the", "master", "instance", "to", "handle", "write"], "content_hash": "753252a7ee158738f595fd8faf5910d2"}