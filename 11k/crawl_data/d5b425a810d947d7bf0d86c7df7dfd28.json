{"url": "https://swiki.ics.uci.edu/doku.php/hardware:nvidia", "word_count": 797, "words": ["Nvidia", "[Support", "Wiki]", "Trace:", "\u2022", "Nvidia", "Nvidia", "Sidebar", "ICS", "Accounts", "Announcement", "and", "Maintenance", "Backups", "@", "ICS", "Common", "Tasks", "and", "Commands", "Group", "Files", "Hardware", "Support", "cluster", "installation", "monitoring", "Storage", "Labs:", "Software", "List", "and", "Other", "Resources", "Laptop", "Checkout", "Policy", "Nvidia", "WIFI", "@", "UCI", "Instructional", "Support", "Resources", "Network", "os", "policies", "projects", "remote_support", "requesttracker", "Research", "Support", "security", "services", "Software", "Virtual", "Environments", "ICS", "Web", "Applications", "wiki", "Table", "of", "Contents", "Nvidia", "Nvidia", "Driver", "Install", "Centos", "7", "ubuntu-drivers", "Troubleshooting", "GPU", "ERR", "Kernel", "Problem", "Failed", "to", "initialize", "NVML:", "Driver/library", "version", "mismatch", "Serial", "number", "for", "GPU", "GPU", "falling", "off", "the", "bus", "Nvlink", "Some", "other", "useful", "commands", "From", "Exxact", "GPU", "Validation", "Test", "mprime", "for", "CPU/Memory", "Nvidia", "Nvidia", "Driver", "Install", "Centos", "7", "Redhat", "is", "not", "supporting", "consumer", "NVidia", "cards", "so", "we", "followed", "this", "webpage", "to", "get", "the", "drivers", "load:", "https://access.redhat.com/solutions/1155663", "Step", "1", "below", "can", "probably", "be", "skipped", "as", "it", "seemed", "to", "be", "blacklisted", "already.", "Edit", "Grub2", "to", "blacklist", "the", "Nouveau", "driver:", "Edit", "/etc/default/grub", "and", "add", "the", "following", "to", "the", "GRUB_CMDLINE_LINUX", "line:", "modprobe.blacklist=nouveau", "Rebuild", "the", "grub", "config", "and", "restart", "the", "system:", "Rebuild", "the", "/boot/grub2/grub.cfg", "file", "by", "running", "the", "grub2-mkconfig", "-o", "command", "as", "follows:", "On", "BIOS-based", "machines:", "grub2-mkconfig", "-o", "/boot/grub2/grub.cfg", "On", "UEFI-based", "machines:", "grub2-mkconfig", "-o", "/boot/efi/EFI/centos/grub.cfg", "Restart", "the", "system.", "NOTE:", "Sometimes", "even", "after", "following", "the", "above", "steps", "to", "blacklist", "nouveau", "module,", "it", "is", "seen", "loaded", "at", "boot.", "#", "lsmod", "|", "grep", "-i", "nouveau", ".", "Most", "likely,", "this", "gets", "loaded", "from", "initramfs.", "In", "such", "cases,", "follow", "\u201c", "How", "to", "blacklist", "nouveau", "module", "on", "Red", "Hat", "Enterprise", "Linux", "7?", "\u201d", "Install", "latest", "nvidia", "driver", "from", "cuda", "repo", "yum", "install", "nvidia-driver-latest", "\u2013enablerepo", "cuda", "Rebuild", "initramfs:", "Back", "up", "the", "current", "initramfs", "mv", "/boot/initramfs-$(uname", "-r).img", "/boot/initramfs-$(uname", "-r)-nouveau.img", "Build", "the", "new", "one:", "dracut", "/boot/initramfs-$(uname", "-r).img", "$(uname", "-r)", "Reboot", "the", "system", "Run", "'nvidia-smi'", "to", "check", "that", "the", "nvidia", "cards", "are", "visible", "ubuntu-drivers", "This", "will", "show", "the", "card", "in", "the", "server", "along", "with", "available", "nvidia", "drivers.", "ubuntu-drivers", "devices", "Troubleshooting", "GPU", "ERR", "nvidia-smi", "shows", "ERR!", "on", "one", "of", "the", "cards.", "You", "can", "reset", "all", "the", "cards", "with:", "nvidia-smi", "-r", "Or", "for", "a", "specific", "GPU", "card:", "nvidia-smi", "--gpu-reset", "-i", "\"gpu-id\"", "For", "cards", "that", "are", "linked", "by", "an", "NVLINK,", "you", "will", "need", "to", "reset", "both", "GPUs:", "nvidia-smi", "--gpu-reset", "-i", "\"gpu-id-1,", "gpu-id-2\"", "If", "the", "GPU", "still", "has", "a", "process", "latched", "onto", "it,", "you", "can", "find", "out", "the", "process", "by", "running:", "fuser", "-v", "/dev/nvidia*", "You", "can", "then", "kill", "the", "PID.", "Kernel", "Problem", "Sometimes", "the", "kernel", "is", "older", "than", "the", "new", "drivers.", "You", "will", "see", "something", "like", "this:", "NOTE:", "Skipping", "kernel", "installation", "since", "no", "NVIDIA", "driver", "kernel", "module", "package", "kmod-nvidia-450.51.06-4.18.0-240.1.1", "for", "kernel", "kernel-4.18.0-240.1.1.el8_3.x86_64", "and", "driver", "nvidia-driver-3:450.51.06-1.el8.x86_64", "could", "be", "found", "In", "this", "case,", "I", "uninstalled", "kmod-nvidia-latest-dkms", "and", "updated", "the", "kernel.", "Then", "reinstalled", "the", "nvidia", "drivers.", "Not", "having", "the", "correct", "matching", "kernel", "driver", "for", "the", "nvidia", "driver", "can", "result", "in", "nvidia-smi", "from", "not", "working.", "Failed", "to", "initialize", "NVML:", "Driver/library", "version", "mismatch", "Got", "this", "error", "on", "an", "Ubuntu", "host.", "Check", "the", "following", "two", "items", "for", "nvidia", "version", "cat", "/proc/driver/nvidia/version", "dpkg", "-l", "|", "grep", "nvidia-driver", "To", "resolve", "the", "mismatch,", "most", "says", "to", "reboot.", "If", "not", "possible,", "do", "the", "following:", "rmmod", "nvidia_drm", "rmmod", "nvidia_modeset", "rmmod", "nvidia_uvm", "rmmod", "nvidia", "nvidia-smi", "If", "this", "a", "slurm", "node,", "please", "restart", "slurm", "service.", "Serial", "number", "for", "GPU", "nvarr=($(nvidia-smi", "-L", "|", "awk", "'", "{gsub(/:/,", "\"\");", "print", "$2}'));", "for", "i", "in", "\"${nvarr[@]}\";", "do", "nvidia-smi", "-i", "$i", "-q", "|", "grep", "-E", "'GPU", "00000000|Minor", "Number|Product", "Name|Product", "Brand|Serial';", "done", "The", "command", "will", "list", "the", "GPU", "and", "the", "serial", "for", "it.", "You", "can", "compare", "the", "bus", "slot", "number", "with", "the", "GPU", "serial", "number", "to", "know", "where", "the", "card", "got", "moved.", "Another", "method", "is:", "nvidia-smi", "--query-gpu=gpu_name,pci.bus,gpu_bus_id,serial,gpu_uuid", "--format=csv", "GPU", "falling", "off", "the", "bus", "We", "have", "seen", "this", "behavior", "with", "overheating", "cards/computationally", "intense", "jobs.", "Example:", "simons-1#", "nvidia-smi", "Unable", "to", "determine", "the", "device", "handle", "for", "GPU0000:B2:00.0:", "Unknown", "Error", "Solution:", "add", "to", "grub", "config", "/etc/default/grub:", "GRUB_CMDLINE_LINUX_DEFAULT=\"pci=realloc=off\"", "Nvlink", "Once", "nvlink", "has", "been", "installed,", "you", "can", "check", "that", "everything", "is", "linked", "up", "working", "properly.", "In", "the", "example", "below,", "two", "nvlinks", "are", "installed", "on", "two", "pairs", "of", "graphic", "cards.", "#", "nvidia-smi", "topo", "-m", "GPU0", "GPU1", "GPU2", "GPU3", "CPU", "Affinity", "NUMA", "Affinity", "GPU0", "X", "NV2", "SYS", "SYS", "0-15,32-47", "0", "GPU1", "NV2", "X", "SYS", "SYS", "0-15,32-47", "0", "GPU2", "SYS", "SYS", "X", "NV2", "16-31,48-63", "1", "GPU3", "SYS", "SYS", "NV2", "X", "16-31,48-63", "1", "Legend:", "X", "=", "Self", "SYS", "=", "Connection", "traversing", "PCIe", "as", "well", "as", "the", "SMP", "interconnect", "between", "NUMA", "nodes", "(e.g.,", "QPI/UPI)", "NODE", "=", "Connection", "traversing", "PCIe", "as", "well", "as", "the", "interconnect", "between", "PCIe", "Host", "Bridges", "within", "a", "NUMA", "node", "PHB", "=", "Connection", "traversing", "PCIe", "as", "well", "as", "a", "PCIe", "Host", "Bridge", "(typically", "the", "CPU)", "PXB", "=", "Connection", "traversing", "multiple", "PCIe", "bridges", "(without", "traversing", "the", "PCIe", "Host", "Bridge)", "PIX", "=", "Connection", "traversing", "at", "most", "a", "single", "PCIe", "bridge", "NV#", "=", "Connection", "traversing", "a", "bonded", "set", "of", "#", "NVLinks", "Some", "other", "useful", "commands", "https://nvidia.custhelp.com/app/answers/detail/a_id/3751/~/useful-nvidia-smi-queries", "nvidia-smi", "--query-gpu=gpu_name,gpu_bus_id,vbios_version", "--format=csv", "nvidia-smi", "--query-gpu=timestamp,name,pci.bus_id,driver_version,pstate,pcie.link.gen.max,pcie.link.gen.current,temperature.gpu,utilization.gpu,utilization.memory,memory.total,memory.free,memory.used", "--format=csv", "-l", "5", "From", "Exxact", "GPU", "Validation", "Test", "https://exxact.atlassian.net/servicedesk/customer/portal/1/article/632029199", "mprime", "for", "CPU/Memory", "https://exxact.atlassian.net/servicedesk/customer/portal/1/article/755041176"], "content_hash": "2a17ade64f6059253f74e9236b48a319"}