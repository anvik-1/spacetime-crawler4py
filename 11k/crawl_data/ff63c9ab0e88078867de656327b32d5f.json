{"url": "http://www.ics.uci.edu/~asuncion/180/amp.c", "word_count": 3834, "words": ["/*", "ART'S", "MULTI-EFFECTS", "PROCESSOR", "(A.M.P.)", "*", "amp.c", "*", "by", "Arthur", "Asuncion,", "for", "ICS", "180", "*", "*", "This", "code", "is", "based", "on", "Professor", "Dobrian's", "pa_cosine.c", "*", "and", "the", "patest_saw.c", "and", "patest_record.c", "files", "included", "with", "PortAudio", "*", "*", "These", "PortAudio", "files", "need", "to", "be", "included", "in", "order", "to", "compile", "this", "program:", "*", "pa_lib.c,", "pa_win_wmme.c,", "pa_trace.h,", "pa_trace.c,", "pa_host.h,", "pa_convert.c,", "portaudio.h", "*", "*", "Also,", "'winmm.lib'", "(a", "standard", "library", "that", "is", "installed", "with", "windows)", "is", "an", "*", "additional", "dependency", "that", "needs", "to", "be", "linked.", "*", "*", "Not", "only", "is", "A.M.P.", "a", "real-time", "processor,", "but", "it", "is", "also", "an", "extensible", "framework", "that", "allows", "*", "DSP", "effects", "to", "be", "easily", "created", "and", "inserted", "into", "the", "effects", "chain.", "Three", "effects", "have", "*", "already", "been", "implemented", "and", "included", "in", "A.M.P.:", "DISTORTION,", "TREMOLO,", "and", "DELAY.", "Additional", "*", "effects", "can", "be", "quickly", "implemented", "by", "emulating", "the", "implementation", "of", "one", "of", "*", "the", "effects", "(DISTORTION", "is", "the", "simplest", "effect", "to", "emulate).", "*", "*", "To", "extend", "this", "framework", "and", "make", "your", "own", "effect,", "simply", "look", "for", "all", "of", "the", "'EXTEND'", "*", "comment", "tags", "and", "replace", "the", "commented", "sample", "code", "with", "your", "specialized", "effect", "code.", "*", "You", "would", "need", "to", "create", "two", "major", "functions:", "the", "effect", "function", "and", "the", "parameter", "*", "modifier", "function.", "*", "*", "Other", "notes:", "*", "1.", "A.M.P.", "allows", "you", "to", "add", "(and", "remove)", "implemented", "effects", "in", "different", "configurations", "*", "in", "real-time.", "*", "2.", "A.M.P.", "allows", "you", "to", "modify", "effect", "parameters", "in", "real-time.", "Note", "that", "there", "is", "only", "one", "*", "set", "of", "parameters", "for", "each", "implemented", "effect.", "For", "instance,", "while", "there", "can", "be", "multiple", "*", "DELAY", "processors", "in", "the", "effects", "chain,", "each", "DELAY", "processor", "would", "have", "the", "same", "parameters.", "*", "3.", "All", "parameters", "are", "restricted", "to", "integer", "values", "between", "1", "and", "9.", "*", "4.", "This", "A.M.P.", "framework", "uses", "2", "channels", "so", "it", "can", "also", "support", "stereo", "(panning)", "effects.", "*/", "#include", "#include", "#include", "#include", "\"portaudio.h\"", "#define", "SAMPLE_RATE", "(44100)", "#define", "TWOPI", "(6.283185307179586)", "#define", "BUFFER_SIZE", "(256)", "/*", "This", "determines", "the", "maximum", "amount", "of", "delay", "(samples)", "that", "the", "DELAY", "effect", "can", "provide", "*/", "#define", "DELAY_BUFFER_SIZE", "(44100)", "/*", "This", "determines", "the", "number", "of", "possible", "effects", "that", "can", "run", "simultaneously", "*/", "#define", "EFFECTS_CHAIN_SIZE", "(10)", "/*", "EXTEND:", "This", "number", "would", "need", "to", "be", "incremented", "if", "additional", "effects", "are", "implemented", "*/", "#define", "NUMBER_IMPLEMENTED_EFFECTS", "(3)", "/*", "This", "struct", "holds", "all", "of", "the", "information", "about", "the", "effects", "chain", "and", "the", "effects.", "*/", "typedef", "struct", "{", "/*", "This", "buffer", "is", "used", "as", "an", "'intermediate'", "to", "transfer", "the", "signal", "from", "*", "one", "effect", "to", "another.", "The", "size", "is", "multiplied", "by", "2", "since", "I", "interleave", "*", "the", "2", "channels.", "*/", "float", "processBuffer", "[2", "*", "BUFFER_SIZE];", "/*", "This", "buffer", "contains", "pointers", "to", "all", "of", "implemented", "effects", "functions.", "*/", "void*", "implementedEffects[NUMBER_IMPLEMENTED_EFFECTS];", "/*", "This", "buffer", "contains", "pointers", "to", "all", "of", "the", "parameter-modifier", "functions.", "*", "Each", "implemented", "effect", "in", "the", "'implementedEfffects'", "buffer", "above", "would", "*", "have", "a", "corresponding", "parameter-modifier", "function", "in", "'parameterFuctions'.", "*/", "void*", "modifierFunctions[NUMBER_IMPLEMENTED_EFFECTS];", "/*", "This", "keeps", "a", "running", "total", "of", "how", "many", "frames", "have", "elapsed", "*/", "int", "count;", "/*", "This", "buffer", "contains", "pointers", "to", "all", "of", "the", "effects", "(functions)", "that", "are", "*", "currently", "in", "the", "effects", "chain.", "*/", "void*", "effectsChain[EFFECTS_CHAIN_SIZE];", "int", "numberEffects;", "/*", "The", "number", "of", "effects", "in", "the", "effects", "chain", "*/", "/*", "parameters", "for", "DISTORTION", "*/", "int", "distortionLevel;", "/*", "value", "from", "1", "-", "9", "*/", "/*", "paramters", "for", "TREMOLO", "*/", "int", "tremoloRate;", "/*", "value", "from", "1", "-", "9", "*/", "int", "tremoloDepth;", "/*", "value", "from", "1", "-", "9", "*/", "/*", "data", "for", "DELAY", "*/", "float", "delayBuffer", "[DELAY_BUFFER_SIZE];", "/*", "1-channel", "buffer", "that", "holds", "previous", "samples", "*/", "int", "delayIndex;", "/*", "index", "for", "the", "current", "position", "in", "the", "delayBuffer", "*/", "/*", "parameters", "for", "DELAY", "*/", "int", "delayFeedback;", "/*", "value", "from", "1", "-", "9", "*/", "int", "delayRate;", "/*", "value", "from", "1-9", "*/", "}", "ampData;", "/*", "Function", "pointer", "type", "for", "an", "effect", "function", "*/", "typedef", "int", "(*fp_Effect)(float*,", "float*,", "int,", "ampData*);", "/*", "Function", "pointer", "type", "for", "an", "effect", "parameter", "modifier", "function", "*/", "typedef", "int", "(*fp_Modifier)();", "/*", "Function", "prototypes", "of", "static", "functions", "(including", "the", "effect", "functions)", "*", "Prototypes", "of", "non-static", "functions", "come", "later", "in", "this", "c", "file.", "*/", "static", "int", "ampCallback(", "void", "*inputBuffer,", "void", "*outputBuffer,", "unsigned", "long", "framesPerBuffer,", "PaTimestamp", "outTime,", "void", "*userData", ");", "static", "int", "distortion", "(float*", "in,", "float*", "out,", "int", "framesPerBuffer,", "ampData*", "data);", "static", "int", "tremolo(float*", "in,", "float*", "out,", "int", "framesPerBuffer,", "ampData*", "data);", "static", "int", "delay(float*", "in,", "float*", "out,", "int", "framesPerBuffer,", "ampData*", "data);", "static", "int", "bypass", "(float*", "in,", "float*", "out,", "int", "framesPerBuffer,", "ampData*", "data);", "/*", "EXTEND:", "*/", "/*", "static", "int", "(float*", "in,", "float*", "out,", "int", "framesPerBuffer,", "ampData*", "data);", "*/", "/*", "This", "callback", "function", "is", "used", "by", "PortAudio.", "*", "*", "PortAudio's", "comments:", "*", "\"This", "routine", "will", "be", "called", "by", "the", "PortAudio", "engine", "when", "audio", "is", "needed.", "*", "It", "may", "called", "at", "interrupt", "level", "on", "some", "machines", "so", "don't", "do", "anything", "*", "that", "could", "mess", "up", "the", "system", "like", "calling", "malloc()", "or", "free().\"", "*/", "static", "int", "ampCallback(", "void", "*inputBuffer,", "void", "*outputBuffer,", "unsigned", "long", "framesPerBuffer,", "PaTimestamp", "outTime,", "void", "*userData", ")", "{", "int", "i;", "/*", "a", "counter", "*/", "/*", "Cast", "data", "passed", "through", "stream", "to", "the", "format", "of", "the", "local", "structure.", "*/", "ampData", "*data", "=", "(ampData*)userData;", "int", "numberEffects", "=", "data->numberEffects;", "/*", "#", "of", "effects", "in", "effects", "chain", "*/", "float", "*in", "=", "(float*)inputBuffer;", "/*", "in", "stream", "*/", "float", "*out", "=", "(float*)outputBuffer;", "/*", "out", "stream", "*/", "float", "*processBuffer", "=", "data->processBuffer;", "/*", "'intermediate'", "buffer", "*/", "float", "*inTemp,", "*outTemp;", "/*", "placeholder", "buffer", "*/", "if", "(numberEffects", "==", "0)", "/*", "signal", "will", "not", "be", "changed", "*/", "{", "bypass(in,", "out,", "framesPerBuffer,", "data);", "}", "else", "{", "/*", "Put", "the", "signal", "through", "all", "of", "the", "effects", "in", "the", "effects", "chain", "*/", "for", "(i", "=", "0;", "i", "<", "numberEffects;", "i++)", "{", "if", "(i", "==", "0)", "inTemp", "=", "in;", "/*", "first", "effect", "receives", "in-buffer", "*/", "else", "inTemp", "=", "processBuffer;", "/*", "'intermediate'", "buffer", "*/", "if", "(i", "==", "numberEffects", "-", "1)", "outTemp", "=", "out;", "/*", "last", "effect", "receives", "out-buffer", "*/", "else", "outTemp", "=", "processBuffer;", "/*", "'intermediate'", "buffer", "*/", "/*", "A", "function", "pointer", "is", "taken", "from", "'effectsChain'", "array", "and", "cast", "to", "the", "*", "fp_Effect", "type", "before", "being", "called.", "*/", "((fp_Effect)", "(data->effectsChain[i]))", "(inTemp,", "outTemp,", "framesPerBuffer,", "data);", "}", "}", "return", "0;", "}", "/*", "This", "bypass", "function", "is", "called", "when", "no", "effects", "are", "in", "the", "effects", "chain.", "*", "It", "is", "structured", "identically", "to", "the"], "content_hash": "a6253a678f1cb403d94cdb2308a9bc0a"}