{"url": "https://wiki.ics.uci.edu/doku.php/accounts:using_vscode_with_slurm", "word_count": 916, "words": ["VSCODE", "with", "SLURM", "[Support", "Wiki]", "Trace:", "\u2022", "VSCODE", "with", "SLURM", "VSCODE", "with", "SLURM", "Sidebar", "ICS", "Accounts", "ICS", "Email", "Services", "Account", "Activation", "Ethical", "Use", "of", "Computing", "Resources", "Mounting", "Remote", "Directories(Samba/SSHFS/NFSv4)", "ICS", "Google", "Account", "ICS", "Home", "Directory", "New", "User", "Guide", "ICS", "Password", "Overview", "Account", "Quotas", "Set", "Up", "SSH", "Keys", "VSCode", "with", "SSH", "VSCODE", "with", "SLURM", "Welcome", "to", "Bren", "ICS!", "Announcement", "and", "Maintenance", "Backups", "@", "ICS", "Common", "Tasks", "and", "Commands", "Group", "Files", "Hardware", "Support", "Instructional", "Support", "Resources", "Network", "os", "policies", "projects", "remote_support", "requesttracker", "Research", "Support", "security", "services", "Software", "Virtual", "Environments", "ICS", "Web", "Applications", "wiki", "Table", "of", "Contents", "VSCODE", "with", "SLURM", "Summary", "Prerequisites", "Overview", "SSH", "Key", "for", "VSCode", "SLURM", "Batch", "Script", "VSCODE", "Setup", "to", "Connect", "to", "SLURM", "Instance", "Related", "VSCODE", "with", "SLURM", "If", "you", "wish", "to", "reserve", "resources", "from", "a", "SLURM", "node", "to", "compile", "and", "test", "code", "on", "it,", "here", "is", "how", "you", "can", "do", "it", "securely.", "Summary", "You", "will", "need", "two", "SSH", "keys.", "One", "for", "connecting", "to", "the", "host", "with", "a", "passphrase", "and", "one", "for", "launching", "the", "SLURM", "job.", "You", "will", "need", "a", "SLURM", "batch", "script", "to", "submit", "a", "job", "for", "requesting", "resources", "and", "running", "your", "own", "SSHD", "process.", "You", "will", "need", "to", "VSCODE", "with", "Remote", "SSH", "extension", "installed.", "Prerequisites", "Before", "starting,", "make", "sure", "you", "have", "setup", "your", "ssh", "keys", "and", "configured", "VSCode", "to", "connect", "to", "Openlab", "Linux", "via", "SSH.", "User", "your", "existing", "SSH", "key", "or", "create", "one.", "Please", "continue", "only", "after", "you", "verified", "you", "can", "connect", "to", "openlab.ics.uci.edu", "with", "your", "SSH", "key.", "Overview", "You", "will", "create", "script", "that", "runs", "an", "SSH", "server", "via", "SLURM", "on", "a", "random", "port", "number.", "You", "will", "determine", "the", "random", "port", "number.", "You", "will", "use", "the", "remote", "SSH", "plugin", "in", "VSCode", "to", "connect", "to", "the", "SLURM", "SSH", "server", "running", "on", "your", "host", "on", "the", "random", "port", "number.", "SSH", "Key", "for", "VSCode", "You", "will", "need", "to", "create", "a", "new", "SSH", "key", "pair", "without", "a", "passphrase", "for", "your", "SSH", "server", "to", "use.", "You", "will", "append", "this", "new", "key", "to", "your", "authorized_keys", "file.", "This", "key", "is", "used", "expressly", "and", "solely", "for", "starting", "the", "SLURM", "SSH", "server.", "You", "do", "not", "use", "this", "key", "to", "login.", "Without", "it,", "you", "will", "be", "unable", "to", "start", "the", "sshd", "process", "via", "SLURM.", "Generate", "a", "Key", "with", "ssh-keygen", "This", "command", "generates", "a", "phraseless", "(unencrypted)", "key", "called", "'vscode_slurm'", "for", "your", "SSH", "server", "to", "user:", "ssh-keygen", "-f", "${HOME}/.ssh/vscode_slurm", "-N", "''", "-t", "rsa", "Update", "authorized_keys", "Append", "the", "contents", "of", "your", "new", "vscode_slurm", "public", "key", "to", "your", "authorized_keys", "file:", "echo", "-n", "'from=\"128.195.0.0/18\"", "'$(cat", "~/.ssh/vscode_slurm.pub)", ">>", "${HOME}/.ssh/authorized_keys", "The", "\u201cfrom=128.195.0.0/18\u201d", "creates", "a", "special", "restriction", "so", "that", "only", "hosts", "on", "a", "wired", "ICS", "network", "can", "use", "the", "vscode_private", "key", "to", "connect.", "An", "SSH", "key", "is", "vulnerable", "without", "a", "passphrase", "hence", "the", "addition", "of", "the", "restriction", "in", "authorized_keys", "file", "to", "prevent", "unauthorized", "connections.", "Your", "key", "should", "look", "something", "this", "in", "the", "authorized_keys", "file:", "from=\"128.195.0.0/18\"", "ssh-rsa", "AAAAB3NzaC1yc2E...", "You", "should", "have", "two", "SSH", "pub", "keys", "in", "your", "authorized_keys", "file.", "One", "that", "was", "specified", "in", "the", "Prerequites", "section", "above", "The", "other", "one", "just", "created", "without", "a", "passphrase", "in", "this", "section", "SSH", "Key", "for", "VSCode", ".", "SLURM", "Batch", "Script", "You", "will", "need", "a", "batch", "script", "such", "as", "the", "following", "but", "modify", "the", "SBATCH", "parameter.", "This", "sample", "script", "is", "set", "to", "end", "after", "4", "days", "and", "note", "that", "the", "SSH", "key", "name", "it", "is", "looking", "for", "is", "called", "vscode_slurm.", "You", "can", "change", "that", "for", "your", "situation.", "For", "more", "info", "about", "SLURM,", "please", "go", "to:", "SLURM", "@", "ICS", "#!/bin/bash", "#SBATCH", "--job-name=vscode_slurm", "#SBATCH", "--time=04:00:00", "#SBATCH", "--output=%x_%j_%N.log", "#SBATCH", "--error=%x_%j_%N.err", "#SBATCH", "--mem=8gb", "#SBATCH", "--gres=gpu:1", "#SBATCH", "--cpus-per-task=4", "#SBATCH", "-p", "openlab.p", "PORT=$(python", "-c", "'import", "socket;", "s=socket.socket();", "s.bind((\"\",", "0));", "print(s.getsockname()[1]);", "s.close()')", "echo", "\"********************************************************************\"", "echo", "\"Starting", "sshd", "in", "Slurm", "as", "user\"", "echo", "\"Environment", "information:\"", "echo", "\"Date:\"", "$(date)", "echo", "\"Allocated", "node:\"", "$(hostname)", "echo", "\"Node", "IP:\"", "$(ip", "a", "|", "grep", "128.195)", "echo", "\"Path:\"", "$(pwd)", "echo", "\"Listening", "on:\"", "$PORT", "echo", "\"********************************************************************\"", "/usr/sbin/sshd", "-D", "-p", "${PORT}", "-f", "/dev/null", "-h", "${HOME}/.ssh/vscode_slurm", "For", "the", "sample", "script,", "please", "save", "it", "with", "a", ".sh", "extension", "to", "just", "identify", "it", "as", "a", "shell", "script.", "To", "run", "it,", "log", "into", "a", "SLURM", "node", "and", "run:", "module", "load", "slurm", "Then", "to", "submit", "a", "job,", "run:", "sbatch", "<slurm_script_name>", "You", "should", "see", "a", ".log", "file", "generated", "and", "within", "it,", "it", "will", "tell", "you", "which", "host", "the", "script", "ran", "on", "and", "the", "port", "it", "is", "listening", "on.", "You", "can", "tell", "it", "to", "run", "a", "specific", "host", "with", "\u201c#SBATCH", "-w", "<server_name>", "You", "may", "want", "to", "change", "the", "slurm", "partition", "as", "well.", "VSCODE", "Setup", "to", "Connect", "to", "SLURM", "Instance", "With", "Remote", "SSH", "Extension,", "create", "a", "new", "SSH", "connection", "for", "vscode", "to", "connect", "to", "your", "SLURM", "instance.", "Click", "on", "'Open", "a", "Remote", "Window'", "button", "in", "the", "lower", "leftmost", "corner.", "Select", "'Remote-SSH:", "Connect", "to", "Host'", "from", "the", "pane", "that", "appears", "at", "the", "top", "of", "the", "window.", "Select", "\u201cConfigure", "SSH", "Hosts", "Select", "config", "file", "in", "your", "user", "profile", "or", "home", "directory.", "On", "Windows,", "it", "is", "\u201cC:\\Users\\<username>\\.ssh\\config", "The", "config", "file", "should", "look", "something", "like", "this:", "Host", "<server_name>", "HostName", "<server_name>", "Port", "<port_number>", "User", "<username>", "IdentityFile", "<path", "to", "your", "SSH", "key", "(the", "one", "with", "the", "passphrase)", ">", "The", "server_name", "and", "port_number", "are", "available", "in", "the", "log", "file", "that", "is", "generated", "by", "running", "your", "SLURM", "job.", "Please", "refer", "to", "that.", "Put", "in", "the", "full", "path", "to", "the", "SSH", "key", "that", "was", "required", "in", "the", "Prerequisites", "section.", "When", "you", "connect", "to", "the", "server,", "you", "will", "be", "asked", "for", "your", "passphrase", "twice.", "The", "first", "time", "is", "for", "logging", "into", "the", "server", "on", "port", "22.", "The", "second", "time", "will", "be", "for", "logging", "into", "the", "server", "on", "the", "higher", "port", "number.", "Related", "If", "you", "just", "want", "to", "run", "VSCODE", "on", "Openlab,", "see", "this", "page:", "Using", "VSCODE", "with", "Remote", "SSH", "on", "Openlab"], "content_hash": "18d005e7c62ee4b73da921dd2063c731"}