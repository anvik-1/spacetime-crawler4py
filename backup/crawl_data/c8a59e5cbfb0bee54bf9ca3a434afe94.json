{"url": "https://grape.ics.uci.edu/wiki/public/wiki/cs122b-2018-winter-project5-mysql-master-slave?version=6", "word_count": 778, "words": ["cs122b-2018-winter-project5-mysql-master-slave", "\u2013", "Public", "Login", "Preferences", "About", "Trac", "Register", "wiki:", "cs122b-2018-winter-project5-mysql-master-slave", "Context", "Navigation", "\u2190", "Previous", "Version", "View", "Latest", "Version", "Next", "Version", "\u2192", "Version", "6", "(modified", "by", "chenli", ",", "8", "years", "ago", ")", "(", "diff", ")", "--", "MySQL", "Master-Slave", "Replication", "This", "tutorial", "shows", "how", "to", "setup", "a", "MySQL", "cluster", "on", "AWS", "that", "includes", "a", "master", "and", "a", "slave.", "Reads", "can", "be", "sent", "to", "any", "of", "the", "two", "instances,", "and", "writes", "have", "to", "be", "sent", "to", "the", "master", "instance.", "Setup", "two", "new", "AWS", "instances:", "Create", "two", "new", "AWS", "instances", "identical", "to", "your", "previous", "instance", "used", "to", "run", "Fabflix.", "We", "call", "these", "\"instance", "2\"", "(as", "the", "master)", "and", "\"instance", "3\"'", "(as", "the", "slave).", "We", "assume", "their", "public", "IPs", "are", "2.2.2.2", "and", "3.3.3.3,", "and", "their", "internal", "AWS", "IPs", "are", "172.2.2.2", "and", "172.3.3.3,", "respectively.", "Add", "new", "rules", "in", "their", "security", "group(s)", "to", "open", "their", "MYSQL/Aurora", "type", "to", "each", "other", "using", "their", "AWS", "internal", "IP.", "Watch", "\u200b", "this", "video", "to", "have", "a", "good", "understanding", "of", "this", "feature.", "The", "following", "steps", "are", "mainly", "based", "on", "those", "instructions", "in", "the", "video.", "Set", "up", "the", "master", "instance.", "SSH", "to", "the", "master", "instance.", "Run", "the", "following", "command", "to", "install", "MySQL", "server.", "master-shell>", "sudo", "apt-get", "update", "master-shell>", "sudo", "apt-get", "install", "mysql-server", "Edit", "the", "/etc/mysql/mysql.conf.d/mysqld.cnf", "file", "and", "set", "the", "bind-address", "to", "0.0.0.0", ".", "Also,", "uncomment", "the", "lines", "of", "server-id", "and", "log_bin", "properties.", "Restart", "the", "MySQL", "service.", "master-shell>", "sudo", "service", "mysql", "restart", "Login", "to", "the", "MySQL", "console.", "Create", "a", "new", "user", "and", "give", "it", "the", "permission", "for", "replicating", "the", "database:", "master-shell>", "mysql", "-u", "root", "-p", "master-mysql>", "create", "user", "'repl'@'%'", "identified", "by", "'slavepassword';", "master-mysql>", "grant", "replication", "slave", "on", "*.*", "to", "'repl'@'%'", ";", "Run", "the", "following", "command", "in", "MySQL", "console", "to", "get", "the", "status", "about", "the", "master", "MySQL:", "master-mysql>", "show", "master", "status;", "Keep", "the", "values", "of", "the", "File", "and", "Position", "columns,", "as", "they", "are", "needed", "in", "the", "next", "step.", "For", "example,", "these", "values", "are", "mysql-bin.000001", "and", "337", ".", "Set", "up", "the", "slave", "instance:", "SSH", "to", "the", "slave", "instance.", "Run", "the", "following", "commands", "to", "install", "MySQL", "server.", "slave-shell>", "sudo", "apt-get", "update", "slave-shell>", "sudo", "apt-get", "install", "mysql-server", "Edit", "the", "/etc/mysql/mysql.conf.d/mysqld.cnf", "file", "and", "set", "the", "bind-address", "to", "0.0.0.0", ".", "Also,", "uncomment", "the", "server-id", "property", "and", "use", "value", "2.", "Do", "not", "uncomment", "the", "log_bin", "property.", "Restart", "the", "MySQL", "service.", "slave-shell>", "sudo", "service", "mysql", "restart", "Login", "to", "the", "MySQL", "console", "and", "let", "the", "slave", "know", "about", "the", "master", "server:", "slave-shell>", "mysql", "-u", "root", "-p", "slave-mysql>", "CHANGE", "MASTER", "TO", "MASTER_HOST='172.2.2.2',", "MASTER_USER='repl',", "MASTER_PASSWORD='slavepassword',", "MASTER_LOG_FILE='mysql-bin.000001',", "MASTER_LOG_POS=337;", "Note", "that", "the", "values", "used", "for", "MASTER_LOG_FILE", "and", "MASTER_LOG_POS", "are", "the", "ones", "from", "the", "last", "step.", "Start", "the", "MySQL", "slave:", "slave-mysql>", "start", "slave;", "slave-mysql>", "show", "slave", "status;", "It", "should", "show", "\"Slave_IO_State:", "Waiting", "for", "master", "to", "send", "event\".", "Test", "if", "the", "synchronization", "works:", "On", "the", "master", "instance,", "create", "a", "database", "with", "a", "table", "with", "a", "tuple:", "master-shell>", "mysql", "-u", "root", "-p", "master-mysql>", "create", "database", "pets;", "master-mysql>", "use", "pets;", "master-mysql>", "create", "table", "cats(name", "varchar(20));", "master-mysql>", "insert", "into", "cats", "values", "(\"fluffy\");", "On", "the", "slave", "instance,", "check", "if", "the", "data", "has", "been", "propagated", "from", "the", "master:", "slave-shell>", "mysql", "-u", "root", "-p", "slave-mysql>", "show", "databases;", "slave-mysql>", "use", "pets;", "slave-mysql>", "show", "tables;", "slave-mysql>", "select", "*", "from", "cats;", "We", "should", "be", "able", "to", "see", "the", "database,", "table,", "and", "record", "on", "this", "instance", "propagated", "from", "the", "master.", "If", "so,", "congratulations!", "Create", "moviedb", "on", "the", "master", "instance:", "Populate", "moviedb", "on", "master", "instance", "using", "\"create_table.sql\"", "and", "\"data.sql\"", "(You", "have", "done", "this", "many", "times)", "On", "the", "slave", "instance,", "check", "if", "the", "data", "is", "automatically", "propagated:", "slave-shell>", "mysql", "-u", "root", "-p", "slave-mysql>", "use", "moviedb;", "show", "tables;", "Note:", "The", "propagation", "is", "only", "from", "the", "master", "to", "the", "slave,", "not", "the", "other", "way", "around.", "To", "test", "it,", "you", "can", "insert", "some", "records", "to", "a", "table", "in", "the", "slave", "database,", "and", "check", "if", "it's", "propagated", "to", "the", "master", "instance.", "It", "should", "NOT!", "Note:", "When", "you", "restart", "your", "AWS", "instances,", "the", "IP", "addresses", "of", "your", "instances", "could", "change.", "At", "this", "time,", "you", "need", "to", "reset", "the", "master", "address", "on", "the", "slave", "instance", "to", "re-connect", "them.", "However,", "note", "that", "MASTER_LOG_FILE", "and", "MASTER_LOG_POS", "could", "change,", "and", "thus", "you", "need", "to", "check", "the", "master", "status", "again.", "master-mysql>", "show", "master", "status;", "slave-mysql>", "stop", "slave;", "slave-mysql>", "CHANGE", "MASTER", "TO", "MASTER_HOST='172.2.2.2',", "MASTER_USER='repl',", "MASTER_PASSWORD='slavepassword',", "MASTER_LOG_FILE='mysql-bin.000001',", "MASTER_LOG_POS=337;", "slave-mysql>", "start", "slave;", "slave-mysql>", "show", "slave", "status;", "Note:", "It", "may", "be", "easy", "for", "you", "to", "create", "new", "AWS", "instances", "using", "an", "image", "of", "an", "existing", "instance.", "I", "will", "show", "how", "to", "do", "it", "in", "class.", "If", "you", "use", "this", "approach,", "make", "sure", "to", "read", "this", "\u200b", "page", "and", "delete", "the", "file", "\"auto.cnf\"", "with", "the", "instance's", "auto-generated", "UUID.", "shell>", "sudo", "\\rm", "-rf", "/var/lib/mysql/auto.cnf", "Note:", "See", "TracWiki", "for", "help", "on", "using", "the", "wiki.", "Download", "in", "other", "formats:", "Plain", "Text", "Powered", "by", "Trac", "1.5.3", "By", "Edgewall", "Software", ".", "Visit", "the", "Trac", "open", "source", "project", "at", "http://trac.edgewall.org/"], "content_hash": "289be7e7f577591cd91b97724385ebf0"}